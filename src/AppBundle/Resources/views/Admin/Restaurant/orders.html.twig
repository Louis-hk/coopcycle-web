{% extends is_granted('ROLE_ADMIN') ? "AppBundle::admin.html.twig" : "AppBundle::profile.html.twig" %}

{% block breadcrumb %}
<li><a href="{{ path(restaurants_route) }}">{% trans %}Restaurants{% endtrans %}</a></li>
<li><a href="{{ path(restaurant_route, { id: restaurant.id }) }}">{{ restaurant.name }}</a></li>
<li>{% trans %}Orders{% endtrans %}</li>
{% endblock %}

{% block content %}

<div class="row">
  <div class="col-md-6">
    <div class="well well-sm"><strong>{% trans %}Today{% endtrans %}</strong></div>
    <div id="order-list"></div>
    {# {% if orders|length > 0 %}
      {% for order in orders %}
        <div class="panel panel-default {% if order.status == 'ACCEPTED' %}panel-info{% endif %}">
          <div class="panel-heading">
            <h3 class="panel-title">Commande #{{ order.id }} </h3>
          </div>
          <div class="panel-body">
            <p class="text-right">{% include "AppBundle:Order:label.html.twig" %}</p>
            <p class="text-right"><i class="fa fa-calendar" aria-hidden="true"></i>  {{ order.createdAt|ago }}</p>

            <table class="table table-condensed">
              <tbody>
                {% for item in order.orderedItem %}
                <tr>
                  <td>{{ item.quantity }} x {{ item.name }}</td>
                  <td class="text-right">{{ item.quantity * item.price }} €</td>
                </tr>
                {% endfor %}
                <tr>
                  <td><strong>Total</strong></td>
                  <td class="text-right"><strong>{{ order.total }} €</strong></td>
                </tr>
              </tbody>
            </table>

            <p class="text-right">
              <i class="fa fa-clock-o" aria-hidden="true"></i>  {{ order.delivery.date|localizeddate('medium', 'short') }}
            </p>
            {% if order.status == 'WAITING' or order.status == 'ACCEPTED' %}
            <hr>
            {% endif %}
            {% if order.status == 'WAITING' %}
            <div class="row">
              <div class="col-sm-6">
                <form method="post" action="{{ path('admin_restaurant_order_refuse', {
                  restaurantId: restaurant.id,
                  orderId: order.id
                }) }}">
                  <button type="submit" class="btn btn-block btn-sm btn-danger">
                    <i class="fa fa-ban" aria-hidden="true"></i>  {% trans %}Refuse{% endtrans %}
                  </button>
                </form>
              </div>
              <div class="col-sm-6">
                <form method="post" action="{{ path('admin_restaurant_order_accept', {
                  restaurantId: restaurant.id,
                  orderId: order.id
                }) }}">
                  <button type="submit" class="btn btn-block btn-sm btn-success">
                    <i class="fa fa-check" aria-hidden="true"></i>  {% trans %}Accept{% endtrans %}
                  </button>
                </form>
              </div>
            </div>
            {% endif %}
            {% if order.status == 'ACCEPTED' %}
              <div class="col-sm-6">
                <form method="post" action="{{ path('admin_restaurant_order_cancel', {
                  restaurantId: restaurant.id,
                  orderId: order.id
                }) }}">
                  <button type="submit" class="btn btn-block btn-sm btn-danger">
                    <i class="fa fa-ban" aria-hidden="true"></i>  {% trans %}Cancel{% endtrans %}
                  </button>
                </form>
              </div>
              <div class="col-sm-6">
                <form method="post" action="{{ path('admin_restaurant_order_ready', {
                  restaurantId: restaurant.id,
                  orderId: order.id
                }) }}">
                  <button type="submit" class="btn btn-block btn-sm btn-success">
                    <i class="fa fa-check" aria-hidden="true"></i>  {% trans %}Ready{% endtrans %}
                  </button>
                </form>
              </div>
            {% endif %}
          </div>
        </div>
      {% endfor %}
    {% else %}
      <div class="alert alert-warning">{% trans %}You don't have any orders yet{% endtrans %}</div>
    {% endif %} #}
  </div>
  <div class="col-md-6">
    <div class="well well-sm"><strong>{% trans %}Tomorrow{% endtrans %}</strong></div>
    <div class="alert alert-warning">{% trans %}You don't have any orders yet{% endtrans %}</div>
  </div>
</div>

{% endblock %}

{% block scripts %}
<script src="/restaurant-panel/socket.io/socket.io.js"></script>
<script>
window.__order_status_i18n = {
  'CREATED':  "{{ 'order.status.CREATED'|trans }}",
  'CANCELED': "{{ 'order.status.CANCELED'|trans }}",
  'WAITING':  "{{ 'order.status.WAITING'|trans }}",
  'ACCEPTED': "{{ 'order.status.ACCEPTED'|trans }}",
  'REFUSED':  "{{ 'order.status.REFUSED'|trans }}",
  'READY':    "{{ 'order.status.READY'|trans }}",
}
window.__restaurant = {{ restaurant_json|raw }};
window.__restaurant = {{ restaurant_json|raw }};
window.__orders = {{ orders_json|raw }};
window.__routes = {
  'order_accept': "{{ path('admin_restaurant_order_accept', { restaurantId: restaurant.id, orderId: '__ORDER_ID__' }) }}",
  'order_refuse': "{{ path('admin_restaurant_order_refuse', { restaurantId: restaurant.id, orderId: '__ORDER_ID__' }) }}",
  'order_cancel': "{{ path('admin_restaurant_order_cancel', { restaurantId: restaurant.id, orderId: '__ORDER_ID__' }) }}",
  'order_ready':  "{{ path('admin_restaurant_order_ready',  { restaurantId: restaurant.id, orderId: '__ORDER_ID__' }) }}"
};
</script>
<script src="{{ asset('js/restaurant-panel.js') }}"></script>
{% endblock %}
